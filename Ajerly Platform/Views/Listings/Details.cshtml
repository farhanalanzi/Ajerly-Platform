@model Ajerly_Platform.Models.Listing
@using System.Globalization

@{
    // determine if this is a rental (has a unit) or sale
    var pu = (Model.PriceUnit ?? string.Empty).ToLower();
    bool isRental = pu.Contains("Ø³Ø§Ø¹Ø©") || pu.Contains("ÙŠÙˆÙ…") || pu.Contains("Ø£Ø³Ø¨ÙˆØ¹") || pu.Contains("Ø§Ø³Ø¨ÙˆØ¹") || pu.Contains("hour") || pu.Contains("day") || pu.Contains("week");
    var badgeText = isRental ? "Ù„Ù„Ø¥ÙŠØ¬Ø§Ø±" : "Ù„Ù„Ø¨ÙŠØ¹";
    var badgeClass = isRental ? "badge-rent" : "badge-sale";

    // price display
    var priceValue = Model.Price;
    string priceDisplay;
    if (priceValue == 0m) priceDisplay = "0";
    else if (decimal.Truncate(priceValue) == priceValue) priceDisplay = ((int)priceValue).ToString(CultureInfo.InvariantCulture);
    else priceDisplay = priceValue.ToString("0.##", CultureInfo.InvariantCulture);

    // price type text
    string priceTypeText = isRental ? "Ø³Ø¹Ø± Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±" : "Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹";
    if (isRental && !string.IsNullOrEmpty(pu))
    {
        if (pu.Contains("Ø³Ø§Ø¹Ø©") || pu.Contains("hour")) priceTypeText += " / Ø³Ø§Ø¹Ø©";
        else if (pu.Contains("ÙŠÙˆÙ…") || pu.Contains("day")) priceTypeText += " / ÙŠÙˆÙ…";
        else if (pu.Contains("Ø£Ø³Ø¨ÙˆØ¹") || pu.Contains("week") || pu.Contains("Ø§Ø³Ø¨ÙˆØ¹")) priceTypeText += " / Ø£Ø³Ø¨ÙˆØ¹";
    }
}

<div class="offer-details-root">
    <!-- Header: sticky white with thin bottom border -->
    <header class="offer-header" role="banner">
        <div class="header-inner">
            <button class="back-btn" onclick="history.back()" aria-label="Ø±Ø¬ÙˆØ¹">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
            <div class="header-title">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶</div>
        </div>
    </header>

    <!-- Hero image full-width -->
    <section class="offer-hero">
        <img class="hero-image" src="@(Model.Images?.FirstOrDefault()?.ImageUrl ?? "/images/default.jpg")" alt="@Model.Title" />
        <div class="hero-badge @badgeClass">@badgeText</div>
    </section>

    <!-- Main content container (white background) -->
    <main class="offer-content">
        <div class="content-inner">
            <!-- Title & Category (right-aligned) -->
            <div class="section title-section">
                <div class="category">@Model.Category</div>
                <h1 class="title">@Model.Title</h1>
            </div>

            <!-- Location -->
            <div class="section location-section">
                <div class="location-row">
                    <svg class="loc-icon" width="18" height="18" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 0a5 5 0 0 0-5 5c0 3.3 5 11 5 11s5-7.7 5-11a5 5 0 0 0-5-5zm0 7.5A2.5 2.5 0 1 1 8 2.5a2.5 2.5 0 0 1 0 5z" fill="currentColor"/></svg>
                    <div class="city">@Model.City</div>
                </div>
            </div>

            <!-- Listing Details -->
            <div class="section details-section">
                <h2>Ø§Ù„ØªÙØ§ØµÙŠÙ„</h2>
                <div class="details-box">@Model.Description</div>
            </div>

            <!-- Price -->
            <div class="section price-section">
                <div class="price-box">
                    <div class="price-label">Ø§Ù„Ø³Ø¹Ø±</div>
                    <div class="price-row">
                        <div class="price-number">@priceDisplay</div>
                        <div class="price-currency">Ø±.Ø³</div>
                    </div>
                    <div class="price-type">@priceTypeText</div>
                </div>
            </div>

            <!-- Posted date centered -->
            <div class="section posted-date">Ù†ÙØ´Ø± ÙÙŠ: @Model.CreatedAt.ToString("yyyy-MM-dd")</div>

            <!-- Seller information -->
            <div class="section seller-section">
                <div class="seller-header"><h2>Ø§Ù„Ø¨Ø§Ø¦Ø¹</h2></div>
                <div class="seller-row">
                    <div class="seller-avatar">@{ var sellerName = Model.User?.FullName ?? string.Empty; var avatar = string.IsNullOrEmpty(sellerName) ? "ØŸ" : sellerName.Substring(0,1); }@avatar</div>
                    <div class="seller-info">
                        <div class="seller-name">@Model.User?.FullName</div>
                        <div class="seller-meta">
                            <span class="verified">âœ“ Ø¨Ø§Ø¦Ø¹ Ù…ÙˆØ«ÙˆÙ‚</span>
                            <span class="transactions">15 Ù…Ø¨ÙŠØ¹Ø§Øª</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contact button and phone box -->
            <div class="section contact-section">
                <button id="contactToggle" class="contact-btn">
                    <span class="chev" aria-hidden="true">â–¾</span>
                    <span class="contact-text">Ø§ØªØµÙ„ Ø¨Ø§Ù„Ø¨Ø§Ø¦Ø¹</span>
                    <span class="phone-icon" aria-hidden="true">ğŸ“</span>
                </button>

                <div id="phoneBox" class="phone-box" aria-hidden="true">
                    <div class="phone-number">@Model.Phone</div>
                    <div class="phone-actions">
                        <a class="btn-call" href="tel:@Model.Phone">Ø§ØªØµØ§Ù„</a>
                        <a class="btn-wa" target="_blank" href="https://wa.me/@(Model.Phone?.Replace("+","").Replace(" ",""))">ÙˆØ§ØªØ³Ø§Ø¨</a>
                    </div>
                </div>
            </div>

        </div>
    </main>
</div>

@section Scripts {
    <script>
        (function(){
            // contact toggle with smooth transition
            var toggle = document.getElementById('contactToggle');
            var box = document.getElementById('phoneBox');
            if(toggle && box){
                toggle.addEventListener('click', function(){
                    var open = box.classList.toggle('open');
                    // rotate chevron
                    toggle.classList.toggle('open');
                    box.setAttribute('aria-hidden', !open);
                });
            }
        })();
    </script>
}
