@model IEnumerable<Ajerly_Platform.Models.Listing>

<h2>إعلاناتي</h2>

<div class="listings-grid" id="myListingsContainer">
    @foreach (var item in Model)
    {
        var firstImage = item.Images?.FirstOrDefault()?.ImageUrl;
        var imageUrl = string.IsNullOrEmpty(firstImage) ? "/images/default.jpg" : Url.Content(firstImage);
        var priceValue = item.Price;
        string priceDisplay = priceValue == 0m ? "0" : (decimal.Truncate(priceValue) == priceValue ? ((int)priceValue).ToString() : priceValue.ToString("0.##"));
        string unitText = (item.PriceUnit ?? string.Empty).ToLower();
        if (unitText.Contains("ساعة") || unitText.Contains("hour")) unitText = "ساعة";
        else if (unitText.Contains("يوم") || unitText.Contains("day")) unitText = "يوم";
        else if (unitText.Contains("أسبوع") || unitText.Contains("اسبوع") || unitText.Contains("week")) unitText = "أسبوع";
        else if (unitText.Contains("شهر") || unitText.Contains("month")) unitText = "شهر";
        else unitText = string.Empty;
        var unitSuffix = string.IsNullOrEmpty(unitText) ? string.Empty : " / " + unitText;

        <div class="listing-card" data-category="@item.Category" data-id="@item.Id">
            <a class="listing-link" href="@Url.Action("Details","Listings", new { id = item.Id })" style="text-decoration:none; color:inherit;">
                <div class="listing-image">
                    @if (!string.IsNullOrEmpty(firstImage))
                    {
                        <img src="@imageUrl" alt="@item.Title" />
                    }
                    else
                    {
                        <div class="empty-image" aria-hidden="true"></div>
                    }

                    <div class="image-overlay"></div>
                    <div class="badge-category">@item.Category</div>
                    <div class="badge-type">عرض</div>
                    <div class="price-pill">@($"{priceDisplay} ر.س{unitSuffix}")</div>
                </div>

                <div class="listing-info">
                    <h3 class="card-title">@item.Title</h3>
                    <div class="seller-name" style="color:#6b7280;font-size:13px;"> بواسطة: @item.User?.FullName</div>
                    <div class="listing-meta">
                        <span class="loc-icon" aria-hidden="true">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 0a5 5 0 0 0-5 5c0 3.3 5 11 5 11s5-7.7 5-11a5 5 0 0 0-5-5zm0 7.5A2.5 2.5 0 1 1 8 2.5a2.5 2.5 0 0 1 0 5z" fill="currentColor"/></svg>
                        </span>
                        <span class="city-name">@item.City</span>
                    </div>
                </div>
            </a>

            <div class="card-footer">
                <div class="footer-right">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M8 0a5 5 0 0 0-5 5c0 3.3 5 11 5 11s5-7.7 5-11a5 5 0 0 0-5-5zm0 7.5A2.5 2.5 0 1 1 8 2.5a2.5 2.5 0 0 1 0 5z"/></svg>
                    <span class="city-name">@item.City</span>
                </div>
            </div>

            <div class="card-actions">
                <a class="btn btn-warning btn-sm" href="@Url.Action("Edit","Listings", new { id = item.Id })">تعديل</a>
                <form method="post" action="@Url.Action("Delete","Listings", new { id = item.Id })" style="display:inline; margin-inline-start:6px;">
                    <button type="submit" class="btn btn-danger btn-sm">حذف</button>
                </form>
            </div>
        </div>
    }
</div>
